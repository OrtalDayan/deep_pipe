@extends(
    "../config_examples/assets/core/core.config",
    "../config_examples/assets/batch_iter/3d_patch.config",
    "../config_examples/assets/model/deepmedic_els.config",
    "../config_examples/assets/training/deepmedic_brats.config",
    "../config_examples/assets/problem/segm.config",
)


n_epochs = 10

batch_size = 15

data_path = "/nmnt/x04-hdd/oasis_brain/"

dataset = dataset_wrapper:cached
    dataset = dataset_wrapper:normalized
        mean = true
        std = true
        dataset = dataset:oasis
            data_path = data_path

split = split:cv_111
    n_splits = 5
    val_size = 5
    dataset = dataset

lr_dec_mul = 0.5

console = io:console()

train_ids = io:json(path=console.train_ids_path)
val_ids = io:json(path=console.val_ids_path)
ids = io:json(path=console.ids_path)

load_x = dataset.load_mscan
n_chans_in = dataset.n_chans_mscan

save_model_path = console.save_model_path
restore_model_path = console.restore_model_path

build_experiment = experiment:flat
    makefile = makefile
    config_path = console.config_path
    experiment_path = console.experiment_path
    split = split

train_model = command:train_model
    train = train
    model = model
    save_model_path = save_model_path
    restore_model_path = "../../oasisnumber/experiment_0/model"

predict = command:predict
    ids = ids
    output_path = console.output_path
    load_x = load_x
    frozen_model = frozen_model
    batch_predict = batch_predict

compute_dices = command:compute_dices
    load_msegm = dataset.load_msegm
    predictions_path = console.predictions_path
    dices_path = console.dices_path
