@from "../config_examples/assets" extends(
    "core/core.config",
    "batch_iter/3d_patch.config",
    "model/deepmedic_els.config",
    "problem/segm.config",
)


n_epochs = 10

batch_size = 15

data_path = "/nmnt/x04-hdd/oasis_brain/"

dataset = dataset_wrapper:cached
    dataset = dataset_wrapper:normalized
        mean = true
        std = true
        dataset = dataset:oasis
            data_path = data_path

split = split:cv_111
    n_splits = 5
    val_size = 5
    dataset = dataset

lr_dec_mul = 0.5

train_model = command:train_model
    train = train
    model = model
    save_model_path = save_model_path
    restore_model_path = "../../oasisnumber/experiment_0/model"

train = train:train_segm
    @lazy

    n_epochs = n_epochs
    lr_init = 0.1
    lr_dec_mul = lr_dec_mul
    patience = 5
    rtol = 0.03
    atol = 0.01

    model = model
    train_ids = train_ids
    val_ids = val_ids
    dataset = dataset
    log_path = console.log_path
    batch_predict = batch_predict
    train_batch_iter_factory = batch_iter_factory
